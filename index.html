<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Global meteor shower activity: LOCAMS network</title>

    <link href="assets/css/book.css" rel="stylesheet">
    <script src="assets/js/lib/d3.min.js?v=3.2.8"></script>
    <script src="assets/js/lib/pikaday/pikaday.js"></script>
    <link href="assets/js/lib/pikaday/css/pikaday.css" rel="stylesheet">
    <script src="http://d3js.org/queue.v1.min.js"></script>

</head>

<body>

    <div class="container">

        <p><link rel="stylesheet" type="text/css" href="maps.css"></p>

<!-- pagetable --------------------------------------------------->
<table border="0" cellspacing="0" cellpadding="0" align="center" width="700">
<tr>
<td valign="top"> 

<!-- header ------------------------------------------------------>
<table border="0" cellspacing="1" cellpadding="0" valign="top" align="center" width="700">
<tr>
<td valign="top" width="150">
<center><P> <a href="https://www.nasa.gov/planetarydefense/overview"><img src="images/NASA_logo.jpg" alt="NASA" width="100" border="0"></a>
</td></P>
<P></center>
<td width="200">
<center><a href="http://cams.seti.org"><img src="images/CAMSbanner.jpg" alt="CAMS" width="200" border="0"></a>
</center>
</td>
<td>
<center>
<P><BR></P>
<input type="text" id="datepicker" placeholder="Pick a date">
<P><BR></P>

</td>
</tr>
</table>

</tr>
</td>
<P>
<tr>
<td>
<!-- main page ------------------------------------------------------>
<table border="0" cellspacing="1" cellpadding="0" valign="top" align="center" width="700">
<tr bgcolor="#DDDDDD" valign="top">

    <td style="background-color:#D9DFED; border-left: 1px solid #808090; border-top: 1px solid #808090; border-right: 1px solid #000000; border-bottom: 1px solid #000000; padding-left: 0px;" align=center height=7 width="150"><font size = "-1"> <B>ALL Networks</B></font></td>

    <td style="background-color:#D9DFED; border-left: 1px solid #808090; border-top: 1px solid #808090; border-right: 1px solid #000000; border-bottom: 1px solid #000000; padding-left: 0px;" align=center height=7 width="68">
<font size = "-1"> <a href="http://cams.seti.org/FDL/index-LOCAMS.html">LOCAMS</a></font></td>

  <td valign="top" style="background-color:#D9DFED; border-left: 1px solid #808090; border-top: 1px solid #808090; border-right: 1px solid #000000; border-bottom: 1px solid #000000; padding-left: 0px;" align=center height=7 width="68">
<font size = "-1"><a href="http://cams.seti.org/FDL/index-BeNeLux.html">BeNeLux</a></font></td>

    <td style="background-color:#D9DFED; border-left: 1px solid #808090; border-top: 1px solid #808090; border-right: 1px solid #000000; border-bottom: 1px solid #000000; padding-left: 0px;" align=center height=7 width="68"><font size = "-1"> <a href="http://cams.seti.org/FDL/index-EXOSS.html">Brazil</a></font></td>

    <td style="background-color:#D9DFED; border-left: 1px solid #808090; border-top: 1px solid #808090; border-right: 1px solid #000000; border-bottom: 1px solid #000000; padding-left: 0px;" align=center height=7 width="68"><font size = "-1"><a href="http://cams.seti.org/FDL/index-cams.html" >California</a></font></td>

    <td style="background-color:#D9DFED; border-left: 1px solid #808090; border-top: 1px solid #808090; border-right: 1px solid #000000; border-bottom: 1px solid #000000; padding-left: 0px;" align=center height=7 width="68">
<font size = "-1"><a href="http://cams.seti.org/FDL/index-FL.html">Florida</a></font></td>

    <td style="background-color:#D9DFED; border-left: 1px solid #808090; border-top: 1px solid #808090; border-right: 1px solid #000000; border-bottom: 1px solid #000000; padding-left: 0px;" align=center height=7 width="68">
<font size = "-1"><a href="http://cams.seti.org/FDL/index-MA.html">Maryland</a></font></td>

    <td style="background-color:#D9DFED; border-left: 1px solid #808090; border-top: 1px solid #808090; border-right: 1px solid #000000; border-bottom: 1px solid #000000; padding-left: 0px;" align=center height=7 width="68">
<font size = "-1"><a href="http://cams.seti.org/FDL/index-NZ.html">Nw Zeal.</a></font></td>

    <td style="background-color:#D9DFED; border-left: 1px solid #808090; border-top: 1px solid #808090; border-right: 1px solid #000000; border-bottom: 1px solid #000000; padding-left: 0px;" align=center height=7 width="68">
<font size = "-1"><a href="http://cams.seti.org/FDL/index-SA.html">S. Africa</a></font></td>

    <td style="background-color:#D9DFED; border-left: 1px solid #808090; border-top: 1px solid #808090; border-right: 1px solid #000000; border-bottom: 1px solid #000000; padding-left: 0px;" align=center height=7 width="68">
<font size = "-1"><a href="http://cams.seti.org/FDL/index-UACN.html">U.A.E.</a></font></td>

</TR>
</TABLE>

</td>
</tr>
<tr>
<td>
<!-------sphere---------------------------------------------------->
<div id="orthographic"></div>

<style>
.cellestial-globe {
//     fill: #030031;
     fill: #050231;
//     fill: #DDDDEF;
     pointer-events: none;
}

.meteor {
     fill: #FFFFFF;
     fill-opacity: 1.0;
}

.star {
     fill: #DDDDDD;
     fill-opacity: 0.5;
}

.sun {
     fill: #FFFFFF;
     fill-opacity: 1.0;
}

.star-label {
     text-transform: uppercase;
     font-size: 10px;
     fill: #fff;
     fill-opacity: 0.6;
}

.graticule {
     fill: none;
     stroke: #aaa;
     stroke-width: 1px;
     stroke-opacity: 0.3;
     pointer-events: none;
}

.graticule-black {
     fill: none;
     stroke: #555;
     stroke-width: 1px;
     stroke-opacity: 0.5;
}
.popup {
    position: absolute;
    z-index: 100;
    height: 30px;
    font-size: 16pt;
    width: 60px;
    border: 2px solid white;
    border-radius: 12px;
    background-color: white;
}
.info {
    position: absolute;
    z-index: 100;
    height: 80px;
    font-size: 10pt;
    width: 80px;
    border: 2px solid black;
    border-radius: 3px;
    background-color: white;
}

</style>

<script>
    function addZ(n){return n<10? '0'+n:''+n;}
    function getToday(){
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth()+1; //January is 0
        var yyyy = today.getFullYear();
        return `${yyyy}_${addZ(mm)}_${addZ(dd)}`;
    }
    

    var picker = new Pikaday({ 
        field: document.getElementById('datepicker'),
        toString(date, format) {
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const year = date.getFullYear();
            return `${year}_${addZ(month)}_${addZ(day)}`;
        },
        onSelect: function () {
            selectDate();
        },
        defaultDate: getToday()
    });
    
    
    //initial queue, to load first data
    var q = queue();
    q.defer(d3.json, "json/ALL/sun.json");
    q.defer(d3.json, "json/ALL/hyg"+getToday()+"_00_00_00.json");
    q.defer(d3.json, "json/ALL/ALL"+getToday()+"_00_00_00.json");

    q.await(function(error, sun, stars, meteors){
        if(error){
            console.log("[q]could not read data");
        } else{
            console.log("[q]loaded data")
            createD3(sun, stars, meteors);
        }
    });

    //queue, to load selected data
    function selectDate(){
        var newQ = queue();
        console.log(picker.toString('yyyy_mm_dd'));
        newQ.defer(d3.json, "json/ALL/sun.json");
        newQ.defer(d3.json, "json/ALL/hyg"+picker.toString('yyyy_mm_dd')+"_00_00_00.json");
        newQ.defer(d3.json, "json/ALL/ALL"+picker.toString('yyyy_mm_dd')+"_00_00_00.json");
        newQ.await(function(error, sun, stars, meteors){
            if(error){
                console.log("[nq]could not read data");
            } else{
                console.log("[nq]loaded data")
                createD3(sun, stars, meteors);
            }
    });
    }


    function createD3(sun, stars, meteors){
                    console.log("[d3] Got data.")
                    d3.select('#orthographic').select("svg").remove()

                    var width = 690,
                        height = 690;

                    // Select the container div and append the SVG element
                    var div = d3.select('#orthographic'),
                        svg = div.append('svg')
                            .attr('width', width)
                            .attr('height', height);

                    //Store the current rotation
                    var rotate = {x:289, y:0};

                    //Create and configure an instance of the orthographic proj.
                    var projection = d3.geo.orthographic()
                        .scale(1.5 * height / Math.PI)
                        .translate([width / 2, height / 2])
                        .clipAngle(90)
                        .rotate([rotate.x / 1, -rotate.y / 1]);

                    // Overlay
                    var overlay = svg.selectAll('circle').data([rotate])
                        .enter().append('circle')
                        .attr('r', height / 2)
                        .attr('transform', 'translate(' + [width / 2, height / 2] + ')')
                        .attr('class', 'overlay')
                        .attr('fill-opacity', 0);

                    // Create and configure the geographic path generator
                    // METEOR
                    var meteorPath = d3.geo.path().projection(projection);
                    // STAR
                    var starPath = d3.geo.path().projection(projection);
                    // SUN
                    var sunPath = d3.geo.path().projection(projection);

                    // Append data
                    // METEOR
                    svg.append('path').datum({type: 'Sphere'})
                        .attr('class', 'cellestial-globe')
                        .attr('d', meteorPath);
                    // STAR
                    svg.append('path').datum({type: 'Sphere'})
                        .attr('class', 'cellestial-globe')
                        .attr('d', starPath);


                    // SUN
                    svg.append('path').datum({type: 'Sphere'})
                        .attr('class', 'cellestial-globe')
                        .attr('d', sunPath);



                    var img = svg.append("svg:image")
                            .attr( "daylight.jpg")
                            .attr("width", 200)
                            .attr("height", 200)
                            .attr("x", 228)
                            .attr("y",53)
                            .style("opacity", 1);




                    var graticule = d3.geo.graticule();

                    // Draw graticule lines
                    var lines = svg.selectAll('path.graticule').data([graticule()])
                        .enter().append('path')
                        .attr('class', 'graticule')
                        .attr('d', meteorPath);

                    // Get color info
                    var color_scale = d3.scale
                       .linear()
                       .domain([0, 7, 17, 27, 37, 47, 57, 67, 120])
                       .range(['rgb(255,255,255)', 'rgb(160,32,240)', 'rgb(0,0,255)', 'rgb(0,165,255)', 'rgb(0,255,0)', 'rgb(255,255,0)', 'rgb(255,165,0)', 'rgb(255,0,0)']);

                    // Size of symbol
                    // METEOR
                    var rScale = d3.scale
                        .linear()
                        .domain(d3.extent(meteors.features, function(d) { return d.properties.mag; }))
                        .range([0, 3]);

                    // STAR
                    var rScale = d3.scale
                        .linear()
                        .domain(d3.extent(stars.features, function(d) { return d.properties.mag; }))
                        .range([3, 1]);


                    // Compute the radius for the point features
                    // METEOR
                    meteorPath.pointRadius(function(d) {
                        return d.properties ? rScale(d.properties.mag) : 1;
                    });
                    // STAR
                    starPath.pointRadius(function(d) {
                        return d.properties ? rScale(d.properties.mag) : 1;
                    })
                    // SUN
                    sunPath.pointRadius(function(d) {
                        return d.properties ? rScale(d.properties.mag) : 1;
                    })

                    //handle meteor mouse hover event
                    var handleMouseOver = function(d) {
                        var popup = '<div class="popup" style="top:' + d3.event.clientY + 'px;left:' + d3.event.clientX + 'px">' + '<a> &nbsp </a>' + d.properties.name + '</div>';

                        var info = '<div class="info" style="top:200px;left:150px">' +   '<a> <span>sl : '  +   parseFloat(d.properties.sol).toFixed(3)   + '<br>&lambda; : ' +  parseFloat(d.geometry.coordinates[0]).toFixed(2) + ' <br>&beta; : ' +   parseFloat(d.geometry.coordinates[1]).toFixed(2) + ' <br>Vg : ' + parseFloat(d.properties.velocg).toFixed(2)  + '</span></a>'   +    '</div>';

                        $('body').append(popup);
                        $('body').append(info);
                    }

                    var handleMouseOut = function() {
                        $('.popup').remove();
                        $('.info').remove();
                    }

                    var handleMouseClick = function(d) {
                        window.open('https://www.meteorshowers.org/view/iau-' + d.properties.name); 
                    }

                    // Data points
                    // METEOR
                    var meteorsDataPoint = svg.selectAll('path.meteor').data(meteors.features)
                        .enter().append('path')
                        .attr('class', 'meteor')
                        .style('fill', function(d) {
                            return color_scale(d.properties.color) })
                        .attr('d', meteorPath)
                        .on("click", function(d){
                            handleMouseClick(d);})
                        .on("mouseover", function(d){
                            handleMouseOver(d);})
                        .on('mouseout', handleMouseOut);


                    // STAR
                    var starsDataPoint = svg.selectAll('path.star').data(stars.features)
                        .enter().append('path')
                        .attr('class', 'star')
.attr('d', starPath)
                        .attr('stroke', 'black')
                        .attr('stroke-width', '1');
                    // SUN
                    var sunDataPoint = svg.selectAll('path.sun').data(sun.features)
                        .enter().append('path')
                        .attr('class', 'sun')


                        .style('fill', function(d) {
                            return color_scale(d.properties.color) })
                        .attr('d', sunPath)
                        .attr('stroke', 'black')
                        .attr('stroke-width', '1');

                    // Drag behavior
                    var dragBehavior = d3.behavior.drag()
                        .origin(Object)
                        .on('drag', drag);
                    var rotationComplete = false;

                    function drag(d) {
                         
                        if(!d3.event || !rotationComplete) {
                            d3.event = {'x' : 5*d.x, 'y':0}
                        }
                        projection.rotate([(d.x = d3.event.x), -(d.y = d3.event.y) ]);
                        // METEOR
                        meteorsDataPoint.attr('d', function(u) {
                            var p = meteorPath(u);
                            return p ? p : 'M 10 10';
                        });
                        // STAR
                        starsDataPoint.attr('d', function(u) {
                            var p = starPath(u);
                            return p ? p : 'M 10 10';
                        });
                        // SUN
                        sunDataPoint.attr('d', function(u) {
                            var p = sunPath(u);
                            return p ? p : 'M 10 10';
                        });
                        // METEOR
                        lines.attr('d', meteorPath);
                        // STAR
                        lines.attr('d', starPath);
                        // SUN
                        lines.attr('d', sunPath);
                    }
                    

                    overlay.call(dragBehavior);
                    var i = 20;

                    var globeRotationInterval = setInterval(function() {
                        drag({'x':1*(i-1)+270, 'y':0});
                        i--;
                        if(i === 0) {
                            rotationComplete = true;
                            clearInterval(globeRotationInterval);
                        }
                      }, 30);
                    d3.select(window).on("load", globeRotationInterval);

                      // }   

                }

</script>

</center>
</td>
</tr>
<tr>
<td valign="top"> 

<!----Number of captured meteors -------------------------------->
<table width="700">
<tr>
<td>

<P><center><img src="./images/ALLLogo.jpg" alt="CAMS Banner" width="700"></center>
<P><a href="http://cams.seti.org">CAMS Project Website</a>


</td>
</tr>
</table>



</td>
</tr>
<tr>
<td>
<P>
</td>
</tr>
<tr>
<td>
<!-- footer --------------------------------------------------------------->
<table border="0" cellspacing="0" cellpadding="0" align="center" width="700">
<tr bgcolor="#D9DFED" link="#0099FF" vlink="#0055AA" text="#FFFFCC"
alink="#CC0000">
<td valign="top" width="700">
<P><B>GLOBAL METEOR SHOWER ACTIVITY</B>
<P><B>Site useage:</B> Requires HTML5 compatable browser. Place cursor in "Pick a date" window. From pop-up calendar, select a past date for which data are available from one of the CAMS meteor video surveillance networks (currently 2017_08_01 to present). </P>

<P><B>Explanation: </B> The celestial sphere shows stars in gray and meteors in colors (showers: red = fast, blue = slow) or white (non-showers). New showers will show up as groupings of white dots. Rotate sphere with cursor. Hover to get the IAU stream number. Click to bring up new window to see shower in space. Data are projected in sun-centered ecliptic coordinates.</P>

</td>
</tr>
</table>
</td>
</tr>

<tr>
<td>
<P>
</td>
</tr>
<tr>
<td>
<!-- footer --------------------------------------------------------------->
<table border="0" cellspacing="0" cellpadding="10" align="center" width="700">
<tr bgcolor="#D5D5D5" link="#0099FF" vlink="#0055AA" text="#FFFFCC"
alink="#CC0000">

<td valign="top" width="220">
<a href="http://www.seti.org"><img src="images/SETIInstitutelogo.jpg" alt="SETI Institute logo" align="left" height="100" width="200" border="0"></a>
</td>

<td valign="top" width="280">
<font size="-1">
    Hosted by: <a href="http://www.seti.org">The SETI Institute</a>
<BR>Curator: <a href="mailto:petrus.m.jenniskens@nasa.gov">Peter Jenniskens</a>
<BR>Responsible NASA Official: Lindley Johnson &nbsp;
<P>Updates provided daily    

<P><a href="mailto:Petrus.M.Jenniskens@nasa.gov">Start a new network?
Contact us.</a>

</font>
</td>

<td valign="top" width="200">
<a href="http://sidgan.me/nasaweb"><img src="images/FDL_comet.jpg" alt="FDL logo" align="left" height="111" border="0"></a>
</td>

</tr>
</table>
<!-- end footer ------------------------------------------------------>

</td>
</tr>
</table>

<!-- end pagetable --------------------------------------------------->

        <div class="footer"></div>
    </div>
    <script src="http://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</body>
</html>
