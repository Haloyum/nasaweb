<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Global meteor shower activity: LOCAMS network</title>

    <link href="assets/css/book.css" rel="stylesheet">
    <script src="assets/js/lib/d3.min.js"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>

</head>

<body>

    <div class="container">

        <p><link rel="stylesheet" type="text/css" href="maps.css"></p>

<table width="700">
<tr>
<td valign="top" width="200"> 
<!-- side bar ------------------------------------------------------>
<center>
    <a href="http://www.frontierdevelopmentlab.org/"><img src="images/NASA_logo.jpg" alt="NASA" width="100" border="0"></a>
<BR><a href="http://cams.seti.org"><img src="images/CAMSbanner.jpg" alt="CAMS" width="200" border="0"></a>
<P><BR></P>
<P><a style="color:black; text-decoration:none" href="./index.html"><B>All Networks:</b></a></p>
<P><a style="color:black; text-decoration:none" href="./index-BeNeLux.html">BeNeLux</a></p>
<P><a style="color:black; text-decoration:none" href="./index-cams.html">California</a></p>
<P><a style="color:black; text-decoration:none" href="./index-EXOSS.html">EXOSS</a></p>
<P><a style="color:black; text-decoration:none" href="./index-FL.html">Florida</a></p>
<P><a style="color:black; text-decoration:none" href="./index-LOCAMS.html">LOCAMS</a></p>
<P><a style="color:black; text-decoration:none" href="./index-MA.html">Mid-Atlantic</a></p>
<P><a style="color:black; text-decoration:none" href="./index-NZ.html">New Zealand</a></p>
<P><a style="color:black; text-decoration:none" href="./index-SA.html">South Africa</a></p>
<P><a style="color:black; text-decoration:none" href="./index-UACN.html">UACN</a></p>

<P><BR></P>
<P><BR></P>
<a href="mailto:Petrus.M.Jenniskens@nasa.gov">Start a new network?
<BR>Contact us.</a>

</center>
</td>
<td valign="top" width="500"> 
<!-- main page ------------------------------------------------------>
<center>
[NO REAL DATA YET: SITE IS UNDER CONSTRUCTION]


<div id="orthographic"></div>

<style>
.cellestial-globe {
     fill: #030031;
     pointer-events: none;
}

.star {
     fill: #FFFFFF;
     fill-opacity: 1.0;
}

.star1 {
     fill: #FFFFFF;
     fill-opacity: 0.5;
}


.star-label {
     text-transform: uppercase;
     font-size: 10px;
     fill: #fff;
     fill-opacity: 0.6;
}

.graticule {
     fill: none;
     stroke: #aaa;
     stroke-width: 1px;
     stroke-opacity: 0.5;
     pointer-events: none;
}

.graticule-black {
     fill: none;
     stroke: #555;
     stroke-width: 1px;
     stroke-opacity: 0.5;
}
.popup {
    position: absolute;
    z-index: 100;
    height: 30px;
    font-size: 16pt;
    width: 60px;
    border: 2px solid white;
    border-radius: 12px;
    background-color: white;
}
</style>

<!-- sphere ---------------------------------------------------------->


<script>
    var today = new Date(); 
    var dd = today.getDate(); 
    var mm = today.getMonth()+1; //January is 0! 
    var yyyy = today.getFullYear(); 
    if(dd<10) {     dd = '0'+dd } 
    if(mm<10) {     mm = '0'+mm } 

//    d3.json('json/LOCAMS/' + yyyy + '-' + mm + '-' + dd + '.json', function(error, data) {
//    d3.json('json/LOCAMS/2017-05-03.json', function(error, data) {

    queue()
        .defer(d3.json, "json/LOCAMS/hyg2017-05-03.json")
        .defer(d3.json, "json/LOCAMS/2017-05-03.json")
        .await(function(error, stars, meteors) {
                if(error) {
                    console.log("Not able to read files");
                }else {
                    var width = 500,
                        height = 500;

                    // Select the container div and append the SVG element
                    var div = d3.select('#orthographic'),
                        svg = div.append('svg')
                            .attr('width', width)
                            .attr('height', height);

                    //Store the current rotation
                    var rotate = {x:289, y:0};

                    //Create and configure an instance of the orthographic projection
//                    console.log(d3);
                    var projection = d3.geo.orthographic()
                        .scale(1.5 * height / Math.PI)
                        .translate([width / 2, height / 2])
                        .clipAngle(90)
                        .rotate([rotate.x / 1, -rotate.y / 1]);

                    // Overlay
                    var overlay = svg.selectAll('circle').data([rotate])
                        .enter().append('circle')
                        .attr('r', height / 2)
                        .attr('transform', 'translate(' + [width / 2, height / 2] + ')')
                        .attr('class', 'overlay')
                        .attr('fill-opacity', 0);

                    // METEOR Create and configure the geographic path generator
                    var meteorPath = d3.geo.path().projection(projection);

                    // STAR 
                    var starPath = d3.geo.path().projection(projection);

                    // METEOR
                    svg.append('path').datum({type: 'Sphere'})
                        .attr('class', 'cellestial-globe')
                        .attr('d', meteorPath);

                    // STAR 
                    svg.append('path').datum({type: 'Sphere'})
                        .attr('class', 'cellestial-globe')
                        .attr('d', starPath);

                    var graticule = d3.geo.graticule();

                    // Draw graticule lines
                    var lines = svg.selectAll('path.graticule').data([graticule()])
                        .enter().append('path')
                        .attr('class', 'graticule')
                        .attr('d', meteorPath);

                    // Get color info
                    var color_scale = d3.scale

                       .linear()
                       .domain([0, 7, 17, 27, 37, 47, 57, 67, 120])
                       .range(['rgb(255,255,255)', 'rgb(160,32,240)', 'rgb(0,0,255)', 'rgb(0,165,255)', 'rgb(0,255,0)', 'rgb(255,255,0)', 'rgb(255,165,0)', 'rgb(255,0,0)']);

                    // Size of symbol
                    var rScale = d3.scale
                        .linear()
                        .domain(d3.extent(stars.features, function(d) { return d.properties.mag; }))
                        .range([1.5, 1]);


                    // Compute the radius for the point features
                    // METEOR
                    meteorPath.pointRadius(function(d) {
                        return d.properties ? rScale(d.properties.mag) : 1;
                    });

                    // STAR 
                    starPath.pointRadius(function(d) {
                        return d.properties ? rScale(d.properties.mag) : 1;
                    })

                    //handle meteor mouse hover event
                    var handleMouseOver = function(d) {

//                        console.log("hovered", d3.event, d3.event, d);
                        var popup = '<div class="popup" style="top:' + d3.event.clientY + 'px;left:' + d3.event.clientX + 'px">' + '<a> &nbsp </a>' + d.properties.name + '</div>';
                        $('body').append(popup);
                    }

                     var handleMouseOut = function() {
                        $('.popup').remove();
                    }

                    // Data points meteors
                    // METEOR
                    var meteorsDataPoint = svg.selectAll('path.star').data(meteors.features)
                        .enter().append('path')
                        .attr('class', 'star')
                        .style('fill', function(d) {
//                            return color_scale(d.properties.color) })
                            return color_scale(d.properties.velocg) })
                        .attr('d', meteorPath)
                        .on("mouseover", function(d){
                            handleMouseOver(d);})
                        .on('mouseout', handleMouseOut);



                    // Data points stars
                    // STAR 
                    var starsDataPoint = svg.selectAll('path.star1').data(stars.features)
                        .enter().append('path')
                        .attr('class', 'star1')
//                         .style('fill', '#dd0dd0')
                        .attr('d', starPath);

                    

                    var dragBehavior = d3.behavior.drag()
                        .origin(Object)
                        .on('drag', drag);
                    var rotationComplete = false;

                    function drag(d) {
                         
                        if(!d3.event || !rotationComplete) {
                            d3.event = {'x' : 5*d.x, 'y':0}
                        }
//                        console.log(d, d3.event);
                        projection.rotate([(d.x = d3.event.x), -(d.y = d3.event.y) ]);
                        // METEOR
                        meteorsDataPoint.attr('d', function(u) {
                            var p = meteorPath(u);
                            return p ? p : 'M 10 10';
                        });
                        // STAR 
                        starsDataPoint.attr('d', function(u) {
                            var p = starPath(u);
                            return p ? p : 'M 10 10';
                        });
                        // METEOR
                        lines.attr('d', meteorPath);
                        // STAR 
                        lines.attr('d', starPath);
                    }
                    

                    overlay.call(dragBehavior);
                    var i = 20;

                    var globeRotationInterval = setInterval(function() {
                        drag({'x':1*(i-1)+270, 'y':0});
                        i--;
                        if(i === 0) {
                            rotationComplete = true;
                            clearInterval(globeRotationInterval);
                        }
                      }, 30);
                    d3.select(window).on("load", globeRotationInterval);

                      // }   
                }
    });

</script>


<P><B><size=+2>Today's date:
<script>
today = yyyy + '-' + mm + '-' + dd; 
document.write(today);
</script>
</size></B>

<P>
  Most meteors today: 
  <BR>Last submission by: 
</center>
<P><BR></P>
<P><BR></P>
<P><BR></P>
</td>
</tr>
</table>

<!-- footer --------------------------------------------------------------->

<table border="0" cellspacing="0" cellpadding="10" summary="footer" align="center" width=700>
<tr bgcolor="#D5D5D5" link="#0099FF" vlink="#0055AA" text="#FFFFCC"
alink="#CC0000">

<td valign="top" width="200">
<img src="images/SETIInstitutelogo.jpg" alt="SETI Institute logo" align="left" height="100">
</td>

<td>
<font size="-1">
    Hosted by: <a href="http://www.seti.org">The SETI Institute</a>
<BR>Curator: <a href="mailto:petrus.m.jenniskens@nasa.gov">Peter Jenniskens</a>
<BR>Responsible NASA Official: Lindley Johnson &nbsp;
<P>Updates provided daily    
</font>
</td>

<td valign="top" width="200">
<img src="images/FDL_comet.jpg" alt="FDL logo" align="left" height="111">
</td>


</tr>
</table>

<!-- end footer ---------------------------------------------------------->

        <div class="footer"></div>
    </div>
    <script src="http://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="assets/js/lib/twinkle.js"></script>
</body>
</html>
