<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Global meteor shower activity: LOCAMS network</title>

    <link href="assets/css/book.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="maps.css">
    <script src="assets/js/lib/d3.min.js"></script>
    <script src="assets/js/lib/pikaday/pikaday.js"></script>
    <link href="assets/js/lib/pikaday/css/pikaday.css" rel="stylesheet">
    <script src="http://d3js.org/queue.v1.min.js"></script>
    <link href="assets/css/custom.css" rel="stylesheet">

</head>

<body>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-2 menu-col">
            <div class="row menu-logo">
                <a href="http://www.frontierdevelopmentlab.org/"><img src="images/NASA_logo.jpg" alt="NASA" border="0" class="img-responsive center-block"></a>
                <a href="http://cams.seti.org"><img src="images/CAMSbanner.jpg" alt="CAMS" border="0" class="img-responsive center-block"></a>
            </div>
            <div class="row network-nav">
                <ul>
                    <li class="active-link"><a  href="./index.html">All networks</a></li>
                    <li><a  href="./index-BeNeLux.html">BeNeLux</a></li>
                    <li><a href="./index-cams.html">Californias</a></li>
                    <li><a href="./index-EXOSS.html">EXOSS</a></li>
                    <li><a href="./index-FL.html">Florida</a></li>
                    <li><a href="./index-LOCAMS.html">LOCAMS</a></li>
                    <li><a href="./index-MA.html">Mid-Atlantic</a></li>
                    <li><a href="./index-NZ.html">New Zealand</a></li>
                    <li><a href="./index-SA.html">South Africa</a></li>
                    <li><a href="./index-UACN.html">UACN</a></li>
                </ul>
            </div>
            <div class="row contact">
                <a class="center-block" href="mailto:Petrus.M.Jenniskens@nasa.gov">Start a new network?
                <BR>Contact us.</a>
            </div>
        </div>





        <div class="col-md-10 col-md-offset-2">
            <div class="row title-row">
                Global meteor shower activity: LOCAMS network  |  [NO REAL DATA YET: SITE IS UNDER CONSTRUCTION]
            </div>
            <div class="row">
                <center>
                <div id="orthographic" class="center-block"></div>
                </center>
            </div>
            <div class="row">
                <P class="today-date"><B><size=+2>Today's date:
                    <script>
                    function addZ(n){return n<10? '0'+n:''+n;}
    function getToday(){
        var today = new Date(); 
        var dd = today.getDate(); 
        var mm = today.getMonth()+1; //January is 0! 
        var yyyy = today.getFullYear(); 
        return `${yyyy}-${addZ(mm)}-${addZ(dd)}`;
    }
                    today = getToday(); 
                    document.write(today);
                    </script>
</size></B>
                <input type="text" id="datepicker" placeholder="Pick a date" class="center-block">
            </div>
            <div class="row" id="footer">
                <div class="col-md-3">
                      <font size="-1">
    Hosted by: <a href="http://www.seti.org">The SETI Institute</a>
<BR>Curator: <a href="mailto:petrus.m.jenniskens@nasa.gov">Peter Jenniskens</a>
<BR>Responsible NASA Official: Lindley Johnson &nbsp;
<P>Updates provided daily    
</font>
                    
                    
                </div>
             <!--    <div class="col-md-1">
                <img src="images/SETI_white.png" alt="SETI Institute logo" class="img-responsive center-block"/>
                    
                </div>
                <div class="col-md-1">
                  <img src="images/comets_badge.png" alt="SETI Institute logo"  class="img-responsive center-block"/>
                </div> -->
            </div>
        </div>
    </div>
</div>

<!-- <div id="footer">
    <div class="container">
        <div class="row">
             <div class="col-md-2">
                    
                    <img src="images/comets_badge.png" alt="SETI Institute logo"  class="img-responsive center-block"/>
                    
                </div>
                <div class="col-md-2">
                <img src="images/SETI_white.png" alt="SETI Institute logo" class="img-responsive center-block"/>
                    
                </div>
        </div>
    </div>
</div> -->




    
<style>
.cellestial-globe {
     fill: #030031;
     pointer-events: none;
}

.star {
     fill: #FFFFFF;
     fill-opacity: 1.0;
}

.star1 {
     fill: #FFFFFF;
     fill-opacity: 0.5;
}


.star-label {
     text-transform: uppercase;
     font-size: 10px;
     fill: #fff;
     fill-opacity: 0.6;
}

.graticule {
     fill: none;
     stroke: #aaa;
     stroke-width: 1px;
     stroke-opacity: 0.5;
     pointer-events: none;
}

.graticule-black {
     fill: none;
     stroke: #555;
     stroke-width: 1px;
     stroke-opacity: 0.5;
}
.popup {
    position: absolute;
    z-index: 100;
    height: 30px;
    font-size: 16pt;
    width: 60px;
    border: 2px solid white;
    border-radius: 12px;
    background-color: white;
}
</style>

<!-- sphere ---------------------------------------------------------->


<script>
    function addZ(n){return n<10? '0'+n:''+n;}
    function getToday(){
        var today = new Date(); 
        var dd = today.getDate(); 
        var mm = today.getMonth()+1; //January is 0! 
        var yyyy = today.getFullYear(); 
        return `${yyyy}-${addZ(mm)}-${addZ(dd)}`;
    }

    var picker = new Pikaday({ 
        field: document.getElementById('datepicker'),
        toString(date, format) {
        
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const year = date.getFullYear();
            return `${year}-${addZ(month)}-${addZ(day)}`;
        },
        onSelect: function () {
            selectDate();
        },
        defaultDate: getToday()
     });

    
    



    //initial queue, to load first data
    var q = queue();
    q.defer(d3.json, "json/LOCAMS/hyg2017-05-03.json");
    q.defer(d3.json, "json/LOCAMS/2017-05-03.json");

    /********** SWITCH TO THIS TO GET THE DATA FOR TODAY ****************

    q.defer(d3.json, "json/LOCAMS/hyg"+getToday()+".json");
    q.defer(d3.json, "json/LOCAMS/"+getToday()+".json");

    *********************************************************************/

    q.await(function(error, stars, meteors){
        if(error){
            console.log("[q]could not read data");
        } else{
            console.log("[q]loaded data")
            createD3(stars, meteors);
        }
    });

    function selectDate(){
        var newQ = queue();
        console.log(picker.toString('YYYY-MM-DD'));
        newQ.defer(d3.json, "json/LOCAMS/hyg"+picker.toString('YYYY-MM-DD')+".json");
        newQ.defer(d3.json, "json/LOCAMS/"+picker.toString('YYYY-MM-DD')+".json");
        newQ.await(function(error, stars, meteors){
            if(error){
                console.log("[nq]could not read data");
            } else{
                console.log("[nq]loaded data")
                createD3(stars, meteors);
            }
    });
    }

    function createD3(stars, meteors){
                    console.log("[d3] Got data.")
                    d3.select('#orthographic').select("svg").remove()
                    //dynamic size
                    var width =  ($( "#orthographic" ).width()*0.45),
                        height = ($( "#orthographic" ).width()*0.45);

                    // Select the container div and append the SVG element
                    var div = d3.select('#orthographic'),
                        svg = div.append('svg')
                            .attr('width', width)
                            .attr('height', height);

                    //Store the current rotation
                    var rotate = {x:289, y:0};

                    //Create and configure an instance of the orthographic projection
//                    console.log(d3);
                    var projection = d3.geo.orthographic()
                        .scale(1.5 * height / Math.PI)
                        .translate([width / 2, height / 2])
                        .clipAngle(90)
                        .rotate([rotate.x / 1, -rotate.y / 1]);

                    // Overlay
                    var overlay = svg.selectAll('circle').data([rotate])
                        .enter().append('circle')
                        .attr('r', height / 2)
                        .attr('transform', 'translate(' + [width / 2, height / 2] + ')')
                        .attr('class', 'overlay')
                        .attr('fill-opacity', 0);

                    // METEOR Create and configure the geographic path generator
                    var meteorPath = d3.geo.path().projection(projection);

                    // STAR 
                    var starPath = d3.geo.path().projection(projection);

                    // METEOR
                    svg.append('path').datum({type: 'Sphere'})
                        .attr('class', 'cellestial-globe')
                        .attr('d', meteorPath);

                    // STAR 
                    svg.append('path').datum({type: 'Sphere'})
                        .attr('class', 'cellestial-globe')
                        .attr('d', starPath);

                    var graticule = d3.geo.graticule();

                    // Draw graticule lines
                    var lines = svg.selectAll('path.graticule').data([graticule()])
                        .enter().append('path')
                        .attr('class', 'graticule')
                        .attr('d', meteorPath);

                    // Get color info
                    var color_scale = d3.scale

                       .linear()
                       .domain([0, 7, 17, 27, 37, 47, 57, 67, 120])
                       .range(['rgb(255,255,255)', 'rgb(160,32,240)', 'rgb(0,0,255)', 'rgb(0,165,255)', 'rgb(0,255,0)', 'rgb(255,255,0)', 'rgb(255,165,0)', 'rgb(255,0,0)']);

                    // Size of symbol
                    var rScale = d3.scale
                        .linear()
                        .domain(d3.extent(stars.features, function(d) { return d.properties.mag; }))
                        .range([1.5, 1]);


                    // Compute the radius for the point features
                    // METEOR
                    meteorPath.pointRadius(function(d) {
                        return d.properties ? rScale(d.properties.mag) : 1;
                    });

                    // STAR 
                    starPath.pointRadius(function(d) {
                        return d.properties ? rScale(d.properties.mag) : 1;
                    })

                    //handle meteor mouse hover event
                    var handleMouseOver = function(d) {

//                        console.log("hovered", d3.event, d3.event, d);
                        var popup = '<div class="popup" style="top:' + d3.event.clientY + 'px;left:' + d3.event.clientX + 'px">' + '<a> &nbsp </a>' + d.properties.name + '</div>';
                        $('body').append(popup);
                    }

                     var handleMouseOut = function() {
                        $('.popup').remove();
                    }

                    // Data points meteors
                    // METEOR
                    var meteorsDataPoint = svg.selectAll('path.star').data(meteors.features)
                        .enter().append('path')
                        .attr('class', 'star')
                        .style('fill', function(d) {
//                            return color_scale(d.properties.color) })
                            return color_scale(d.properties.velocg) })
                        .attr('d', meteorPath)
                        .on("mouseover", function(d){
                            handleMouseOver(d);})
                        .on('mouseout', handleMouseOut);



                    // Data points stars
                    // STAR 
                    var starsDataPoint = svg.selectAll('path.star1').data(stars.features)
                        .enter().append('path')
                        .attr('class', 'star1')
//                         .style('fill', '#dd0dd0')
                        .attr('d', starPath);

                    

                    var dragBehavior = d3.behavior.drag()
                        .origin(Object)
                        .on('drag', drag);
                    var rotationComplete = false;

                    function drag(d) {
                         
                        if(!d3.event || !rotationComplete) {
                            d3.event = {'x' : 5*d.x, 'y':0}
                        }
//                        console.log(d, d3.event);
                        projection.rotate([(d.x = d3.event.x), -(d.y = d3.event.y) ]);
                        // METEOR
                        meteorsDataPoint.attr('d', function(u) {
                            var p = meteorPath(u);
                            return p ? p : 'M 10 10';
                        });
                        // STAR 
                        starsDataPoint.attr('d', function(u) {
                            var p = starPath(u);
                            return p ? p : 'M 10 10';
                        });
                        // METEOR
                        lines.attr('d', meteorPath);
                        // STAR 
                        lines.attr('d', starPath);
                    }
                    

                    overlay.call(dragBehavior);
                    var i = 20;

                    var globeRotationInterval = setInterval(function() {
                        drag({'x':1*(i-1)+270, 'y':0});
                        i--;
                        if(i === 0) {
                            rotationComplete = true;
                            clearInterval(globeRotationInterval);
                        }
                      }, 30);
                    d3.select(window).on("load", globeRotationInterval);

                      // }   
                }
    

</script>


    <script src="http://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="assets/js/lib/twinkle.js"></script>
</body>
</html>
